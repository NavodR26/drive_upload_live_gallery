<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPBL - Live Photo Gallery</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', Arial, sans-serif;
            overflow: hidden;
            background: #000;
            color: white;
            height: 100vh;
            position: relative;
        }

        /* Enhanced background with dynamic effects */
        #background-effects {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .neon-wave {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 20, 147, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(0, 191, 255, 0.08) 0%, transparent 25%),
                radial-gradient(circle at 40% 80%, rgba(255, 215, 0, 0.08) 0%, transparent 25%);
            animation: waveMove 20s infinite linear;
        }

        .neon-wave:nth-child(2) {
            animation-delay: -5s;
            opacity: 0.7;
        }

        .neon-wave:nth-child(3) {
            animation-delay: -10s;
            opacity: 0.5;
        }

        @keyframes waveMove {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Gold particles */
        .gold-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: gold;
            border-radius: 50%;
            box-shadow: 0 0 10px gold, 0 0 20px gold;
            animation: floatParticle 15s infinite linear;
        }

        @keyframes floatParticle {
            0% { transform: translateY(100vh) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(20px); opacity: 0; }
        }

        /* Header - Moved to top-left */
        #header {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            pointer-events: none;
            text-align: left;
        }

        #header h1 {
            font-family: 'Cinzel', serif;
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 4px;
            color: #e8e8e8;
            text-transform: uppercase;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.3);
            margin-bottom: 5px;
            position: relative;
        }

        #header .subtitle {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 14px;
            color: #c0c0c0;
            letter-spacing: 2px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        /* 3D Gallery Container */
        #gallery-space {
            position: fixed;
            width: 100%;
            height: 100%;
            perspective: 2000px;
            perspective-origin: 50% 50%;
        }

        #carousel-wrapper {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Enhanced Glass Cards with Photo Frames */
        .glass-card {
            position: absolute;
            border-radius: 20px;
            overflow: visible;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 40px 100px rgba(0, 0, 0, 0.8),
                0 0 0 1px rgba(255, 255, 255, 0.15),
                0 0 40px rgba(255, 215, 0, 0.25),
                inset 0 0 30px rgba(255, 255, 255, 0.08);
            
            padding: 20px;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0.15) 0%, 
                rgba(255, 255, 255, 0) 100%);
            pointer-events: none;
            z-index: 1;
            border-radius: 20px 20px 0 0;
        }

        .glass-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            background: linear-gradient(135deg, 
                rgba(255, 215, 0, 0.15) 0%, 
                rgba(255, 20, 147, 0.08) 50%, 
                rgba(0, 191, 255, 0.15) 100%);
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .glass-card:hover::after {
            opacity: 1;
        }

        .photo-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
            border-radius: 12px;
            position: relative;
            background: rgba(0, 0, 0, 0.3);
        }

        .glass-card img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            filter: brightness(0.9) contrast(1.05);
            transition: all 0.5s;
        }

        .glass-card:hover img {
            filter: brightness(1) contrast(1.1);
            transform: scale(1.03);
        }

        /* Positioning states - No highlighting for active photo */
        .glass-card.center {
            z-index: 100;
            transform: translateX(0) translateZ(250px) scale(1.1);
            filter: drop-shadow(0 20px 40px rgba(255, 215, 0, 0.3));
        }

        .glass-card.left-1 {
            transform: translateX(-550px) translateZ(0) rotateY(40deg) scale(0.95);
            opacity: 0.9;
            z-index: 80;
        }

        .glass-card.left-2 {
            transform: translateX(-1000px) translateZ(-150px) rotateY(55deg) scale(0.8);
            opacity: 0.7;
            z-index: 60;
        }

        .glass-card.left-3 {
            transform: translateX(-1400px) translateZ(-300px) rotateY(70deg) scale(0.65);
            opacity: 0.5;
            z-index: 40;
        }

        .glass-card.right-1 {
            transform: translateX(550px) translateZ(0) rotateY(-40deg) scale(0.95);
            opacity: 0.9;
            z-index: 80;
        }

        .glass-card.right-2 {
            transform: translateX(1000px) translateZ(-150px) rotateY(-55deg) scale(0.8);
            opacity: 0.7;
            z-index: 60;
        }

        .glass-card.right-3 {
            transform: translateX(1400px) translateZ(-300px) rotateY(-70deg) scale(0.65);
            opacity: 0.5;
            z-index: 40;
        }

        .glass-card.hidden {
            opacity: 0;
            transform: translateZ(-800px) scale(0.1);
            pointer-events: none;
        }

        /* Enhanced Entry Animations */
        .glass-card.entering {
            animation: slideInFromTop 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .glass-card.popup {
            animation: popupEffect 1.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .glass-card.spin {
            animation: spinEffect 1.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card.zoom {
            animation: zoomEffect 1.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .glass-card.swing {
            animation: swingEffect 1.7s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .glass-card.float {
            animation: floatEffect 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .glass-card.bounce {
            animation: bounceEffect 1.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .glass-card.flip {
            animation: flipEffect 1.6s cubic-bezier(0.455, 0.03, 0.515, 0.955);
        }

        .glass-card.rotate {
            animation: rotateEffect 1.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes slideInFromTop {
            0% {
                opacity: 0;
                transform: translateY(-120vh) rotateX(90deg) scale(0.3);
            }
            70% {
                transform: translateY(30px) rotateX(-5deg) scale(1.15);
            }
            100% {
                opacity: 1;
                transform: translateY(0) rotateX(0) scale(1.1);
            }
        }

        @keyframes popupEffect {
            0% {
                opacity: 0;
                transform: scale(0.1) rotate(180deg);
            }
            70% {
                transform: scale(1.1) rotate(-10deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0);
            }
        }

        @keyframes spinEffect {
            0% {
                opacity: 0;
                transform: rotateY(360deg) scale(0.3);
            }
            100% {
                opacity: 1;
                transform: rotateY(0) scale(1);
            }
        }

        @keyframes zoomEffect {
            0% {
                opacity: 0;
                transform: scale(0.05);
            }
            70% {
                transform: scale(1.15);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes swingEffect {
            0% {
                opacity: 0;
                transform: rotateZ(-45deg) translateY(100vh) scale(0.5);
            }
            70% {
                transform: rotateZ(10deg) translateY(-30px) scale(1.05);
            }
            100% {
                opacity: 1;
                transform: rotateZ(0) translateY(0) scale(1);
            }
        }

        @keyframes floatEffect {
            0% {
                opacity: 0;
                transform: translateY(100vh) rotate(5deg) scale(0.7);
            }
            60% {
                transform: translateY(-20px) rotate(-2deg) scale(1.05);
            }
            100% {
                opacity: 1;
                transform: translateY(0) rotate(0) scale(1);
            }
        }

        @keyframes bounceEffect {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-30px);
            }
            60% {
                transform: translateY(-15px);
            }
        }

        @keyframes flipEffect {
            0% {
                opacity: 0;
                transform: rotateX(90deg) scale(0.5);
            }
            100% {
                opacity: 1;
                transform: rotateX(0) scale(1);
            }
        }

        @keyframes rotateEffect {
            0% {
                opacity: 0;
                transform: rotate(180deg) scale(0.3);
            }
            100% {
                opacity: 1;
                transform: rotate(0) scale(1);
            }
        }

        /* Badge */
        .badge {
            position: absolute;
            top: 25px;
            right: 25px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 25px;
            font-family: 'Poppins', sans-serif;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 2px;
            color: rgba(255, 215, 0, 0.95);
            text-transform: uppercase;
            z-index: 10;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        /* Ambient lighting effect */
        .ambient-light {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(139, 69, 19, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 255, 255, 0.04) 0%, transparent 70%);
            animation: ambientShift 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes ambientShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Reflection effect on floor */
        .reflection {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 35%;
            background: linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.6) 100%);
            pointer-events: none;
            z-index: -1;
        }

        /* Loading indicator */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Cinzel', serif;
            font-size: 32px;
            color: #e8e8e8;
            letter-spacing: 4px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.05); }
        }

        /* Smooth fade in for everything */
        body {
            animation: fadeIn 1.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Confetti effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: gold;
            opacity: 0;
            z-index: 200;
        }

        /* Floating Photo Wall Background */
        #floating-wall {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }

        .floating-photo {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
            opacity: 0.4;
            filter: blur(2px) brightness(0.8);
            animation: floatAnimation 20s infinite linear;
            transform-origin: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.5s ease;
        }

        .floating-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .floating-photo:hover {
            opacity: 0.7;
            filter: blur(0) brightness(1);
            transform: scale(1.1);
            z-index: 10;
        }

        @keyframes floatAnimation {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
            }
            100% {
                transform: translateY(-200px) translateX(20px) rotate(5deg);
            }
        }

        /* Enhanced Preview Strip - Moved to bottom-right corner */
        #preview-strip {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            z-index: 300;
            max-height: 70vh;
            overflow-y: auto;
            scrollbar-width: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideInRight 0.8s ease-out;
        }

        #preview-strip::-webkit-scrollbar {
            display: none;
        }

        .preview-thumb {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            opacity: 0.7;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            flex-shrink: 0;
            position: relative;
            border: 2px solid transparent;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .preview-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s;
        }

        .preview-thumb:hover {
            opacity: 1;
            transform: scale(1.08);
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .preview-thumb.active {
            opacity: 1;
            border-color: rgba(255, 215, 0, 0.9);
            transform: scale(1.08);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
        }

        .preview-thumb:hover img {
            transform: scale(1.1);
        }

      /* Enhanced Event Info Panel - Compact Bottom Version */
#event-info {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-weight: 500;
    z-index: 250;
    background: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(12px);
    padding: 12px 28px;
    border-radius: 8px;
    border: 1px solid rgba(192, 192, 192, 0.2);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    max-width: 90%;
}

#event-info h2 {
    font-size: 16px;
    color: #e8e8e8;
    letter-spacing: 2px;
    margin-bottom: 4px;
    text-transform: uppercase;
    font-weight: 600;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

#event-info p {
    font-size: 13px;
    color: #a0a0a0;
    letter-spacing: 1px;
    font-style: italic;
    margin: 0;
}

        /* New photo indicator */
        .new-photo-indicator {
            position: absolute;
            top: -3px;
            right: -3px;
            width: 10px;
            height: 10px;
            background: #55042f;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 8px #151515;
        }

        /* Photo counter */
        .photo-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 8px 15px;
            border-radius: 20px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            color: #e8e8e8;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Animation for preview strip and event info */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Remove controls */
        .controls {
            display: none;
        }
    </style>
</head>
<body>
    <div id="background-effects">
        <div class="neon-wave"></div>
        <div class="neon-wave"></div>
        <div class="neon-wave"></div>
    </div>
    
    <div class="ambient-light"></div>
    
    <div id="header">
        <h1>Live Photo Gallery</h1>
        
    </div>

    <div class="photo-counter" id="photo-counter">Photos: 0</div>

    <div id="gallery-space">
        <div id="carousel-wrapper"></div>
    </div>

    <div id="floating-wall"></div>

    <div id="event-info">
        <h2>MPBL - ANNUAL GET TOGETHER & CHRISTMAS PARTY</h2>
        <p>2025</p>
    </div>

    <div id="preview-strip"></div>

    <div class="reflection"></div>

    <div class="loading" id="loading">Connecting...</div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const wrapper = document.getElementById('carousel-wrapper');
        const loadingEl = document.getElementById('loading');
        const floatingWall = document.getElementById('floating-wall');
        const previewStrip = document.getElementById('preview-strip');
        const photoCounter = document.getElementById('photo-counter');
        const photos = [];
        let currentIndex = 0;
        let isRotating = false;
        let newPhotosQueue = [];

        // Initialize effects
        function initEffects() {
            createGoldParticles();
            createPermanentFloatingPhotos();
        }

        // Create gold particles
        function createGoldParticles() {
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'gold-particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 15 + 's';
                document.getElementById('background-effects').appendChild(particle);
            }
        }

        // Create permanent floating background photos
        function createPermanentFloatingPhotos() {
            // Create initial floating photos
            for (let i = 0; i < 15; i++) {
                createFloatingPhoto();
            }
            
            // Continuously add new floating photos
            setInterval(() => {
                if (Math.random() > 0.7 && photos.length > 0) { // 30% chance to add a new photo
                    const randomPhoto = photos[Math.floor(Math.random() * photos.length)];
                    createFloatingPhoto(randomPhoto.url);
                }
            }, 3000);
        }

        // Create enhanced photo card
        function createPhotoCard(url, isMerged = false, isStyled = false) {
            const card = document.createElement('div');
            card.className = 'glass-card entering hidden';
            
            if (isMerged) {
                card.style.width = '900px';
                card.style.height = '600px';
            } else {
                card.style.width = '450px';
                card.style.height = '600px';
            }
            
            const photoContainer = document.createElement('div');
            photoContainer.className = 'photo-container';
            
            const img = document.createElement('img');
            img.src = url;
            img.onerror = () => {
                console.error('Failed to load image:', url);
            };
            photoContainer.appendChild(img);
            
            card.appendChild(photoContainer);

            if (isMerged) {
                const badge = document.createElement('div');
                badge.className = 'badge';
                badge.textContent = 'Group Spotlight';
                card.appendChild(badge);
            } else if (isStyled) {
                const badge = document.createElement('div');
                badge.className = 'badge';
                badge.textContent = 'AI Enhanced';
                card.appendChild(badge);
            }

            wrapper.appendChild(card);
            return card;
        }

        // Create floating background photo
        function createFloatingPhoto(url = null) {
            const floatingPhoto = document.createElement('div');
            floatingPhoto.className = 'floating-photo';
            
            const img = document.createElement('img');
            
            // Use provided URL or placeholder for demo
            if (url) {
                img.src = url;
            } else if (photos.length > 0) {
                // Use a random photo from the gallery
                const randomPhoto = photos[Math.floor(Math.random() * photos.length)];
                img.src = randomPhoto.url;
            } else {
                // Placeholder for background floating photos
                img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjMzMzMzMzIi8+CjxwYXRoIGQ9Ik02MCA0MEM1MS4xNjM0IDQwIDQ0IDQ3LjE2MzMgNDQgNTZDNDQgNjQuODM2NyA1MS4xNjM0IDcyIDYwIDcyQzY4LjgzNjYgNzIgNzYgNjQuODM2NyA3NiA1NkM3NiA0Ny4xNjMzIDY4LjgzNjYgNDAgNjAgNDBaIiBmaWxsPSIjNjY2NjY2Ii8+CjxwYXRoIGQ9Ik00NCA4OEg3NkM3Ny4xMDQ2IDg4IDc4IDg4Ljg5NTQgNzggOTBWMTAyQzc4IDEwMy4xMDQgNzcuMTA0NiAxMDQgNzYgMTA0SDQ0QzQyLjg5NTQgMTA0IDQyIDEwMy4xMDQgNDIgMTAyVjkwQzQyIDg4Ljg5NTQgNDIuODk1NCA4OCA0NCA4OFoiIGZpbGw9IiM2NjY2NjYiLz4KPC9zdmc+';
            }
            
            floatingPhoto.appendChild(img);
            
            // Random position and animation
            floatingPhoto.style.left = Math.random() * 100 + 'vw';
            floatingPhoto.style.animationDelay = Math.random() * 20 + 's';
            floatingPhoto.style.animationDuration = (20 + Math.random() * 20) + 's';
            
            floatingWall.appendChild(floatingPhoto);
        }

        // Create preview thumbnail
        function createPreviewThumb(url, index) {
            const thumb = document.createElement('div');
            thumb.className = 'preview-thumb';
            thumb.dataset.index = index;
            
            const img = document.createElement('img');
            img.src = url;
            thumb.appendChild(img);
            
            previewStrip.appendChild(thumb);
            
            // Limit preview strip to 15 items
            if (previewStrip.children.length > 15) {
                previewStrip.removeChild(previewStrip.firstChild);
            }
            
            // Add new photo indicator for recently added photos
            const isNew = newPhotosQueue.includes(url);
            if (isNew) {
                const indicator = document.createElement('div');
                indicator.className = 'new-photo-indicator';
                thumb.appendChild(indicator);
                
                // Remove from queue after 10 seconds
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.remove();
                    }
                    newPhotosQueue = newPhotosQueue.filter(photoUrl => photoUrl !== url);
                }, 10000);
            }
            
            return thumb;
        }

        // Update preview strip highlighting
        function updatePreviewStrip() {
            const thumbs = document.querySelectorAll('.preview-thumb');
            thumbs.forEach((thumb, index) => {
                if (parseInt(thumb.dataset.index) === currentIndex) {
                    thumb.classList.add('active');
                } else {
                    thumb.classList.remove('active');
                }
            });
        }

        // Update carousel layout
        function updateLayout() {
            photos.forEach((photo, index) => {
                const card = photo.element;
                card.classList.remove('center', 'left-1', 'left-2', 'left-3', 'right-1', 'right-2', 'right-3', 'hidden');
                
                const relativePos = index - currentIndex;
                
                if (relativePos === 0) {
                    card.classList.add('center');
                } else if (relativePos === -1 || (relativePos === photos.length - 1)) {
                    card.classList.add('left-1');
                } else if (relativePos === -2 || (relativePos === photos.length - 2)) {
                    card.classList.add('left-2');
                } else if (relativePos === -3 || (relativePos === photos.length - 3)) {
                    card.classList.add('left-3');
                } else if (relativePos === 1 || (relativePos === -(photos.length - 1))) {
                    card.classList.add('right-1');
                } else if (relativePos === 2 || (relativePos === -(photos.length - 2))) {
                    card.classList.add('right-2');
                } else if (relativePos === 3 || (relativePos === -(photos.length - 3))) {
                    card.classList.add('right-3');
                } else {
                    card.classList.add('hidden');
                }
            });
            
            updatePreviewStrip();
            updatePhotoCounter();
        }

        // Update photo counter
        function updatePhotoCounter() {
            photoCounter.textContent = `Photos: ${photos.length} | Current: ${currentIndex + 1}/${photos.length}`;
        }

        // Add photo with animation
        function addPhoto(url, isMerged = false, isStyled = false) {
            const element = createPhotoCard(url, isMerged, isStyled);
            photos.push({ url, element, isMerged, isStyled });
            
            loadingEl.style.display = 'none';
            
            const animationTypes = ['entering', 'popup', 'spin', 'zoom', 'swing', 'float', 'bounce', 'flip', 'rotate'];
            const randomAnimation = animationTypes[Math.floor(Math.random() * animationTypes.length)];
            element.classList.add(randomAnimation);
            
            // Add to new photos queue for highlighting
            newPhotosQueue.push(url);
            
            setTimeout(() => {
                element.classList.remove('hidden');
                updateLayout();
                createConfetti();
                
                // Add to floating wall and preview strip
                createFloatingPhoto(url);
                createPreviewThumb(url, photos.length - 1);
                
                // If this is the first photo, make it the center
                if (photos.length === 1) {
                    currentIndex = 0;
                    updateLayout();
                }
            }, 100);
        }

        // Create confetti effect
        function createConfetti() {
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                confetti.style.left = (40 + Math.random() * 20) + 'vw';
                confetti.style.top = (40 + Math.random() * 20) + 'vh';
                
                const colors = ['#ffd700', '#ff1493', '#00bfff', '#7cfc00', '#ff4500'];
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const size = 5 + Math.random() * 10;
                confetti.style.width = size + 'px';
                confetti.style.height = size + 'px';
                
                if (Math.random() > 0.5) {
                    confetti.style.borderRadius = '50%';
                }
                
                document.body.appendChild(confetti);
                animateConfetti(confetti);
            }
        }

        function animateConfetti(confetti) {
            let opacity = 1;
            let y = parseFloat(confetti.style.top);
            let x = parseFloat(confetti.style.left);
            const xSpeed = (Math.random() - 0.5) * 3;
            const ySpeed = -3 - Math.random() * 4;
            
            const animate = () => {
                opacity -= 0.02;
                y += ySpeed;
                x += xSpeed;
                
                confetti.style.opacity = opacity;
                confetti.style.top = y + 'vh';
                confetti.style.left = x + 'vw';
                
                if (opacity > 0 && y > -10) {
                    requestAnimationFrame(animate);
                } else {
                    confetti.remove();
                }
            };
            
            animate();
        }

        // Carousel navigation
        function rotateCarousel() {
            if (photos.length === 0 || isRotating) return;
            isRotating = true;
            currentIndex = (currentIndex + 1) % photos.length;
            updateLayout();
            setTimeout(() => { isRotating = false; }, 1000);
        }

        // Auto-rotate every 5 seconds
        setInterval(() => {
            rotateCarousel();
        }, 5000);

        // Socket.IO connection
        const socket = io();

        socket.on('connect', () => {
            loadingEl.textContent = 'Loading photos...';
            initEffects();
        });

        socket.on('all-photos', (data) => {
            // Prioritize merged photos
            if (data.merged && data.merged.length > 0) {
                data.merged.forEach(url => addPhoto(url, true, false));
            }
            
            // Then styled photos
            if (data.styled && data.styled.length > 0) {
                data.styled.forEach(url => addPhoto(url, false, true));
            }
            
            // Then regular photos
            if (data.regular && data.regular.length > 0) {
                data.regular.forEach(url => {
                    const basename = url.split('/').pop();
                    const hasStyled = data.styled && data.styled.some(s => s.includes(basename));
                    if (!hasStyled) {
                        addPhoto(url, false, false);
                    }
                });
            }

            if (photos.length === 0) {
                loadingEl.textContent = 'Waiting for photos...';
                loadingEl.style.display = 'block';
            }
        });

        socket.on('new-photo', (url) => {
            addPhoto(url, false, false);
        });

        socket.on('styled-photo', (data) => {
            const photoIndex = photos.findIndex(p => p.url === data.original);
            if (photoIndex >= 0) {
                photos[photoIndex].element.remove();
                photos.splice(photoIndex, 1);
                if (currentIndex >= photos.length && photos.length > 0) {
                    currentIndex = photos.length - 1;
                }
            }
            addPhoto(data.styled, false, true);
        });

        socket.on('merged-photo', (url) => {
            addPhoto(url, true, false);
        });

        // Fullscreen mode support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'f' || e.key === 'F11') {
                e.preventDefault();
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
        });
    </script>
</body>
</html>